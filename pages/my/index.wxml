<view class="page">
  <!-- é¡¶éƒ¨èƒŒæ™¯ -->
  <view class="header-bg"></view>

  <!-- æ³¢æµªè£…é¥° -->
  <view class="wave-decoration">
    <view class="ink-dots"></view>
  </view>

  <!-- ç”¨æˆ·ä¿¡æ¯å¡ç‰‡ -->
  <view class="user-card">
    <view class="user-info">
      <block wx:if="{{userInfo}}">
        <image 
          class="avatar" 
          src="{{userInfo.avatarUrl || userInfo.avatar}}" 
          bindtap="onUpdateAvatar"
        />
        <view class="info-content">
          <text class="name" bindtap="onUpdateNickname">
            {{userInfo.nickName || userInfo.nickname}}
          </text>
          <text class="bio" bindtap="onUpdateBio">
            {{userInfo.bio || 'è¿™ä¸ªå®¶ä¼™å¾ˆæ‡’ï¼Œä»€ä¹ˆéƒ½æ²¡ç•™ä¸‹~'}}
          </text>
        </view>
      </block>
      <block wx:else>
        <view class="user-info">
          <image class="default-avatar" src="/assets/images/default-avatar.png" />
          <view class="info-content">
            <button 
              class="login-btn" 
              bindtap="onGetUserProfile">
              ç«‹å³ç™»å½•
            </button>
            <text class="login-desc">ç™»å½•åå¯ä»¥ä½“éªŒæ›´å¤šåŠŸèƒ½</text>
          </view>
        </view>
        <view class="stats-bar"></view>
      </block>
    </view>

    <!-- æ•°æ®ç»Ÿè®¡ -->
    <view class="stats-bar">
      <view class="stat-item">
        <text class="count">
          {{userInfo && userInfo.likes ? userInfo.likes.length : 0}}
        </text>
        <text class="label">ç‚¹èµ</text>
      </view>
      <view class="stat-item">
        <text class="count">
          {{userInfo && userInfo.collection ? userInfo.collection.length : 0}}
        </text>
        <text class="label">æ”¶è—</text>
      </view>
    </view>
  </view>

  <!-- æœªç™»å½•æ€ä¸‹çš„åŠŸèƒ½é¢„è§ˆ -->
  <view class="login-features-card" wx:if="{{!userInfo}}">
    <view class="login-features">
      <view class="feature-preview">
        <text class="feature-icon">ğŸ‘</text>
        <text class="feature-text">ç‚¹èµæ”¶è—</text>
      </view>
      <view class="feature-preview">
        <text class="feature-icon">ğŸ“±</text>
        <text class="feature-text">åŒæ­¥æ•°æ®</text>
      </view>
      <view class="feature-preview">
        <text class="feature-icon">ğŸŒŸ</text>
        <text class="feature-text">æ›´å¤šåŠŸèƒ½</text>
      </view>
    </view>
  </view>

  <!-- åŠŸèƒ½åˆ—è¡¨ -->
  <view class="feature-list">
    <view class="feature-item" bindtap="goToMyLikes">
      <view class="feature-left">
        <image class="feature-icon" src="/assets/images/likes.png" />
        <text class="feature-title">æˆ‘çš„ç‚¹èµ</text>
      </view>
      <view class="feature-right">
        <text class="feature-count">{{userInfo.likes.length || 0}}</text>
        <text class="arrow">â€º</text>
      </view>
    </view>

    <view class="feature-item" bindtap="goToMyFavorites">
      <view class="feature-left">
        <image class="feature-icon" src="/assets/images/favorites.png" />
        <text class="feature-title">æˆ‘çš„æ”¶è—</text>
      </view>
      <view class="feature-right">
        <text class="feature-count">{{userInfo.collection.length || 0}}</text>
        <text class="arrow">â€º</text>
      </view>
    </view>
  </view>

  <!-- æ¯æ—¥ä¸€å¥ -->
  <view class="daily-quote" wx:if="{{!quoteLoading && dailyQuote}}">
    <!-- è£…é¥°è¾¹æ¡† -->
    <view class="quote-border">
      <view class="corner top-left"></view>
      <view class="corner top-right"></view>
      <view class="corner bottom-left"></view>
      <view class="corner bottom-right"></view>
    </view>

    <!-- æ°´å¢¨è£…é¥° -->
    <view class="ink-decoration left"></view>
    <view class="ink-decoration right"></view>

    <view class="quote-content">
      <view class="quote-header">
        <view class="ink-line left"></view>
        <text class="quote-title">ä»Šæ—¥ä¹‹è¨€</text>
        <view class="ink-line right"></view>
      </view>
      <text class="quote-mark">ã€</text>
      <text class="quote-text">{{dailyQuote}}</text>
      <text class="quote-mark">ã€</text>
    </view>
  </view>
</view>

<!-- æ˜µç§°è¾“å…¥æ¡† -->
<view class="nickname-modal" wx:if="{{showNicknameInput}}">
  <view class="nickname-content">
    <text class="nickname-title">è¯·è¾“å…¥æ˜µç§°</text>
    <input 
      type="nickname" 
      class="nickname-input" 
      placeholder="è¯·è¾“å…¥æ˜µç§°" 
      model:value="{{tempNickname}}"
      focus="{{true}}"
    />
    <button 
      class="confirm-btn" 
      bindtap="{{userInfo ? 'onConfirmUpdateNickname' : 'onConfirmNickname'}}"
      disabled="{{!tempNickname}}">
      ç¡®å®š
    </button>
  </view>
</view>

<!-- ä¸ªäººç®€ä»‹è¾“å…¥æ¡† -->
<view class="bio-modal" wx:if="{{showBioInput}}">
  <view class="bio-content">
    <text class="bio-title">ç¼–è¾‘ä¸ªäººç®€ä»‹</text>
    <textarea 
      class="bio-input" 
      placeholder="ä»‹ç»ä¸€ä¸‹è‡ªå·±å§~" 
      model:value="{{tempBio}}"
      maxlength="50"
      focus="{{true}}"
    />
    <view class="bio-footer">
      <text class="bio-count">{{tempBio.length}}/50</text>
      <button 
        class="confirm-btn" 
        bindtap="onConfirmUpdateBio">
        ç¡®å®š
      </button>
    </view>
  </view>
</view>

<canvas type="2d" id="avatarCanvas" style="position: fixed; left: -9999px;"></canvas> 